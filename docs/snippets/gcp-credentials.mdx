Qovery needs credentials to manage resources in your GCP project. We use a secure service account approach with minimal required permissions.

### Prepare Your GCP Project

<Steps>
  <Step title="Create or Select Project">
    1. Go to [Google Cloud Console](https://console.cloud.google.com)
    2. Either create a new project or select an existing one
    3. Ensure billing is enabled for the project

    <Frame>
      <img src="/images/gcp-credentials/gcp_project.png" alt="Select or create GCP project" />
    </Frame>

    <Tip>
    Use a dedicated project for Qovery to keep resources organized and costs trackable.
    </Tip>
  </Step>

  <Step title="Note Your Project ID">
    Copy your **Project ID** (not the project name) from the project selector.

    Example: `my-company-production-123456`

    <Info>
    You'll need this Project ID in the next steps.
    </Info>
  </Step>
</Steps>

### Generate Installation Command

<Steps>
  <Step title="Start Cluster Creation">
    1. Go to [Qovery Console](https://console.qovery.com)
    2. Click **Clusters** in the left sidebar
    3. Click **Create Cluster**
    4. Select **GCP** as the cloud provider
  </Step>

  <Step title="Enter Project Details">
    1. Enter your **Project ID**
    2. Click **Next**

    Qovery will generate a secure installation command for you.
  </Step>

  <Step title="Copy the Command">
    Copy the generated command to your clipboard.

    The command will look like:
    ```bash
    curl https://qovery.com/docs/files/create_credentials_gcp.sh | bash -s -- YOUR_PROJECT_ID qovery_role qovery-service-account
    ```

    <Info>
    This script creates a service account with minimal required permissions.
    </Info>
  </Step>
</Steps>

### Run Installation Script

<Steps>
  <Step title="Open Google Cloud Shell">
    1. In Google Cloud Console, click the **Cloud Shell** icon (terminal icon) in the top-right
    2. Wait for Cloud Shell to initialize
    3. Ensure you're in the correct project: `gcloud config get-value project`

    <Frame>
      <img src="/images/gcp-credentials/cloud-shell.png" alt="Open Google Cloud Shell" />
    </Frame>
  </Step>

  <Step title="Run the Command">
    1. Paste the command from Qovery into Cloud Shell
    2. Press **Enter**
    3. The script will:
       - Enable required GCP APIs (Container, Compute, Artifact Registry, Storage, Cloud Resource Manager, Cloud Run)
       - Create a service account named `qovery-service-account`
       - Assign necessary IAM roles
       - Generate and download a JSON key file (`key.json`)

    <Frame>
      <img src="/images/gcp-credentials/gcp_shell_1.png" alt="Run credential creation script" />
    </Frame>

    **Example output:**
    ```bash
    Activating services APIs
    Operation "operations/acf.p2-..." finished successfully.
    ...
    Creating service account qovery-service-account
    Created service account [qovery-service-account].
    ...
    created key [abc123...] of type [json] as [key.json]
    ✓ Credentials configured successfully
    ```
  </Step>

  <Step title="Download the Key File">
    1. In Cloud Shell, click the **More** menu (three dots)
    2. Select **Download**
    3. Enter the file path: `key.json`
    4. Save the file securely

    <Frame>
      <img src="/images/gcp-credentials/gcp_shell_5.png" alt="Download key.json file from Cloud Shell" />
    </Frame>

    <Warning>
    **Keep this JSON key file secure!** It provides access to your GCP project. Never commit it to version control.
    </Warning>
  </Step>

  <Step title="Upload to Qovery">
    1. Return to Qovery Console
    2. Upload the `key.json` file when prompted
    3. Qovery will verify the credentials

    <Frame>
      <img src="/images/gcp-credentials/gcp_shell_6.png" alt="Upload credentials to Qovery Console" />
    </Frame>

    <Tip>
    You can reuse these credentials for multiple clusters in the same GCP project.
    </Tip>
  </Step>
</Steps>

<AccordionGroup>
  <Accordion title="What permissions does Qovery need?">
    Qovery requires these GCP permissions to manage your infrastructure:
    - **Compute Engine**: Create and manage VMs, networks, and load balancers
    - **Kubernetes Engine**: Create and manage GKE clusters
    - **VPC Networking**: Configure networks, subnets, and firewall rules
    - **Service Accounts**: Manage service identities for workloads
    - **Cloud Storage**: Store Terraform state and logs
    - **Artifact Registry**: Store container images
    - **Cloud Run**: Manage serverless deployments (optional)

    The installation script automatically assigns the minimum required roles to the service account.
  </Accordion>

  <Accordion title="Can I use a custom service account?">
    Yes! You can create a service account manually with custom permissions. However, ensure it has all the roles required for managing GKE, Compute Engine, and networking resources. Contact support for the minimal permissions list.
  </Accordion>

  <Accordion title="How do I rotate credentials?">
    To rotate GCP credentials:
    1. In GCP Console, go to **IAM & Admin** → **Service Accounts**
    2. Find the `qovery-service-account`
    3. Click **Keys** → **Add Key** → **Create new key**
    4. Choose **JSON** format and download
    5. Update credentials in Qovery Console
    6. Wait 24 hours, then delete the old key in GCP
  </Accordion>
</AccordionGroup>
