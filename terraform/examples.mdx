---
title: "Terraform Examples"
description: "Practical examples for using the Qovery Terraform Provider"
---

## Basic Application Deployment

Deploy a containerized application with the Qovery Terraform provider:

```hcl
# Define a project
resource "qovery_project" "my_project" {
  organization_id = var.organization_id
  name            = "My Project"
}

# Create an environment
resource "qovery_environment" "production" {
  project_id = qovery_project.my_project.id
  name       = "production"
  mode       = "PRODUCTION"
  cluster_id = var.cluster_id
}

# Deploy an application
resource "qovery_application" "api" {
  environment_id = qovery_environment.production.id
  name           = "api"

  git_repository = {
    url    = "https://github.com/your-org/your-app"
    branch = "main"
  }

  build_mode = "DOCKER"
  dockerfile_path = "Dockerfile"

  cpu    = 500
  memory = 512

  ports = [
    {
      internal_port = 8080
      external_port = 443
      protocol      = "HTTP"
      publicly_accessible = true
    }
  ]

  auto_deploy = true
}
```

## Application with Database

Deploy an application with a PostgreSQL database:

```hcl
# Create a PostgreSQL database
resource "qovery_database" "postgres" {
  environment_id = qovery_environment.production.id
  name           = "main-db"
  type           = "POSTGRESQL"
  version        = "15"
  mode           = "MANAGED"

  cpu    = 250
  memory = 512
  storage = 10
}

# Application with database connection
resource "qovery_application" "backend" {
  environment_id = qovery_environment.production.id
  name           = "backend"

  git_repository = {
    url    = "https://github.com/your-org/backend"
    branch = "main"
  }

  build_mode = "DOCKER"

  # Environment variables for database connection
  environment_variables = [
    {
      key   = "DATABASE_HOST"
      value = qovery_database.postgres.internal_host
    },
    {
      key   = "DATABASE_PORT"
      value = qovery_database.postgres.port
    },
    {
      key   = "DATABASE_NAME"
      value = qovery_database.postgres.name
    }
  ]

  # Database credentials as secrets
  secrets = [
    {
      key   = "DATABASE_USER"
      value = qovery_database.postgres.login
    },
    {
      key   = "DATABASE_PASSWORD"
      value = qovery_database.postgres.password
    }
  ]

  depends_on = [qovery_database.postgres]
}
```

## Multi-Environment Setup

Create multiple environments with different configurations:

```hcl
locals {
  environments = {
    development = {
      mode   = "DEVELOPMENT"
      cpu    = 250
      memory = 256
    }
    staging = {
      mode   = "STAGING"
      cpu    = 500
      memory = 512
    }
    production = {
      mode   = "PRODUCTION"
      cpu    = 1000
      memory = 1024
    }
  }
}

# Create multiple environments
resource "qovery_environment" "envs" {
  for_each = local.environments

  project_id = qovery_project.my_project.id
  name       = each.key
  mode       = each.value.mode
  cluster_id = var.cluster_id
}

# Deploy application to each environment
resource "qovery_application" "app" {
  for_each = local.environments

  environment_id = qovery_environment.envs[each.key].id
  name           = "my-app"

  git_repository = {
    url    = "https://github.com/your-org/app"
    branch = each.key == "production" ? "main" : each.key
  }

  build_mode = "DOCKER"

  cpu    = each.value.cpu
  memory = each.value.memory

  auto_deploy = each.key != "production"
}
```

## Container Registry Configuration

Use a custom container registry:

```hcl
resource "qovery_application" "app" {
  environment_id = qovery_environment.production.id
  name           = "my-app"

  # Use pre-built image from registry
  build_mode = "BUILDPACKS"

  git_repository = {
    url    = "https://github.com/your-org/app"
    branch = "main"
  }

  # Custom registry credentials
  registry_id = var.container_registry_id

  cpu    = 500
  memory = 512
}
```

## Health Checks

Configure health checks for your application:

```hcl
resource "qovery_application" "api" {
  environment_id = qovery_environment.production.id
  name           = "api"

  git_repository = {
    url    = "https://github.com/your-org/api"
    branch = "main"
  }

  build_mode = "DOCKER"

  # Health check configuration
  healthchecks = {
    liveness_probe = {
      type = {
        http = {
          path = "/health"
          port = 8080
        }
      }
      initial_delay_seconds = 30
      period_seconds        = 10
      timeout_seconds       = 5
      failure_threshold     = 3
    }

    readiness_probe = {
      type = {
        http = {
          path = "/ready"
          port = 8080
        }
      }
      initial_delay_seconds = 15
      period_seconds        = 5
      timeout_seconds       = 3
      failure_threshold     = 3
    }
  }
}
```

## Complete Example: Deploying Airbyte

This example shows how to deploy [Airbyte](https://airbyte.com) on Qovery using Terraform. Airbyte is deployed using Helm with a PostgreSQL database and proxy for authentication.

<Info>
This is based on the [qovery-airbyte](https://github.com/evoxmusic/qovery-airbyte) repository - a real-world example of deploying a complex application stack with Qovery.
</Info>

### Prerequisites

Before deploying, gather these IDs from Qovery Console:

```bash
# Required variables
export TF_VAR_qovery_access_token="your-api-token"
export TF_VAR_qovery_organization_id="your-org-id"
export TF_VAR_qovery_project_id="your-project-id"
export TF_VAR_qovery_cluster_id="your-cluster-id"
export TF_VAR_qovery_github_token_id="your-github-token-id"
```

### variables.tf

```hcl
variable "qovery_access_token" {
  description = "Qovery API token"
  type        = string
  sensitive   = true
}

variable "qovery_organization_id" {
  description = "Qovery Organization ID"
  type        = string
}

variable "qovery_project_id" {
  description = "Qovery Project ID"
  type        = string
}

variable "qovery_cluster_id" {
  description = "Qovery Cluster ID"
  type        = string
}

variable "qovery_github_token_id" {
  description = "GitHub token for Qovery"
  type        = string
}

variable "airbyte_helm_version" {
  description = "Airbyte Helm chart version"
  type        = string
  default     = "1.7.1"
}

variable "airbyte_service_name" {
  description = "Airbyte service name"
  type        = string
  default     = "Airbyte"
}

variable "qovery_airbyte_web_app_proxy_basic_auth" {
  description = "Basic Auth for Airbyte web app proxy (htpasswd format)"
  type        = string
  default     = ""
}
```

### main.tf

```hcl
terraform {
  required_providers {
    qovery = {
      source  = "qovery/qovery"
      version = "~> 0.45.0"
    }
  }
}

provider "qovery" {
  token = var.qovery_access_token
}

# Read Airbyte Helm values from file
data "local_file" "airbyte_values" {
  filename = "${path.module}/airbyte-values.yaml"
}

# Create environment for Airbyte
resource "qovery_environment" "airbyte" {
  project_id = var.qovery_project_id
  cluster_id = var.qovery_cluster_id
  name       = "airbyte"
  mode       = "PRODUCTION"

  deployment_stage_order = [
    "DATABASE",
    "APP",
    "PROXY"
  ]
}

# Create PostgreSQL database for Airbyte
resource "qovery_database" "airbyte_db" {
  environment_id = qovery_environment.airbyte.id
  name           = "airbyte-db"
  type           = "POSTGRESQL"
  version        = "17"
  mode           = "MANAGED"
  storage        = 20
  accessibility  = "PRIVATE"

  deployment_stage_id = qovery_environment.airbyte.deployment_stage_ids["DATABASE"]
}

# Add Airbyte Helm repository
resource "qovery_helm_repository" "airbyte" {
  organization_id = var.qovery_organization_id
  name            = "airbyte"
  kind            = "OCI_DOCKER_HUB"
  url             = "https://airbytehq.github.io/helm-charts"
}

# Deploy Airbyte using Helm
resource "qovery_helm" "airbyte" {
  environment_id = qovery_environment.airbyte.id
  name           = var.airbyte_service_name

  source = {
    helm_repository = {
      repository_id = qovery_helm_repository.airbyte.id
      chart_name    = "airbyte"
      chart_version = var.airbyte_helm_version
    }
  }

  # Allow Airbyte to create cluster-wide resources
  allow_cluster_wide_resources = true

  # Override default values
  values_override = {
    file = {
      raw = data.local_file.airbyte_values.content
    }
  }

  # Configure database connection using Qovery environment variables
  environment_variables = [
    {
      key   = "DATABASE_HOST"
      value = qovery_database.airbyte_db.internal_host
    },
    {
      key   = "DATABASE_PORT"
      value = tostring(qovery_database.airbyte_db.port)
    },
    {
      key   = "DATABASE_DB"
      value = "airbyte"
    },
    {
      key   = "DATABASE_USER"
      value = qovery_database.airbyte_db.login
    }
  ]

  secrets = [
    {
      key   = "DATABASE_PASSWORD"
      value = qovery_database.airbyte_db.password
    }
  ]

  deployment_stage_id = qovery_environment.airbyte.deployment_stage_ids["APP"]

  depends_on = [
    qovery_database.airbyte_db,
    qovery_helm_repository.airbyte
  ]
}

# Deploy proxy application for Airbyte web app
resource "qovery_application" "airbyte_webapp_proxy" {
  environment_id = qovery_environment.airbyte.id
  name           = "airbyte-webapp-proxy"

  git_repository = {
    url           = "https://github.com/Qovery/simple-example-with-htt-auth"
    branch        = "main"
    root_path     = "/"
    git_token_id  = var.qovery_github_token_id
  }

  build_mode      = "DOCKER"
  dockerfile_path = "Dockerfile"

  cpu    = 100
  memory = 128

  min_running_instances = 1
  max_running_instances = 1

  ports = [{
    internal_port       = 80
    external_port       = 443
    protocol            = "HTTP"
    publicly_accessible = true
    name                = "http"
  }]

  environment_variables = [
    {
      key   = "TARGET"
      value = "http://airbyte-airbyte-webapp-svc.${qovery_environment.airbyte.id}:80"
    },
    {
      key   = "HTPASSWD"
      value = var.qovery_airbyte_web_app_proxy_basic_auth
    }
  ]

  healthchecks = {
    readiness_probe = {
      type = {
        http = {
          path = "/"
          port = 80
        }
      }
      initial_delay_seconds = 30
      period_seconds        = 10
      timeout_seconds       = 5
      success_threshold     = 1
      failure_threshold     = 3
    }

    liveness_probe = {
      type = {
        http = {
          path = "/"
          port = 80
        }
      }
      initial_delay_seconds = 30
      period_seconds        = 10
      timeout_seconds       = 5
      success_threshold     = 1
      failure_threshold     = 3
    }
  }

  deployment_stage_id = qovery_environment.airbyte.deployment_stage_ids["PROXY"]

  depends_on = [qovery_helm.airbyte]
}
```

### airbyte-values.yaml

Create a `airbyte-values.yaml` file to customize Airbyte configuration:

```yaml
global:
  serviceAccountName: airbyte-admin
  deploymentMode: oss

  database:
    type: external
    host: ${DATABASE_HOST}
    port: ${DATABASE_PORT}
    database: ${DATABASE_DB}
    user: ${DATABASE_USER}
    password: ${DATABASE_PASSWORD}

webapp:
  enabled: true
  replicaCount: 1
  service:
    type: ClusterIP
    port: 80

server:
  enabled: true
  replicaCount: 1

worker:
  enabled: true
  replicaCount: 1

airbyte-bootloader:
  enabled: true
```

### Deployment

```bash
# 1. Clone the repository or create the files above
git clone https://github.com/evoxmusic/qovery-airbyte
cd qovery-airbyte

# 2. Set environment variables
export TF_VAR_qovery_access_token="your-api-token"
export TF_VAR_qovery_organization_id="your-org-id"
export TF_VAR_qovery_project_id="your-project-id"
export TF_VAR_qovery_cluster_id="your-cluster-id"
export TF_VAR_qovery_github_token_id="your-github-token-id"

# 3. Optional: Set basic authentication for web access
export TF_VAR_qovery_airbyte_web_app_proxy_basic_auth=$(htpasswd -nb admin yourpassword)

# 4. Initialize Terraform
terraform init

# 5. Plan deployment
terraform plan

# 6. Apply configuration
terraform apply

# 7. Access Airbyte (after ~5 minutes)
# Get the URL from Qovery Console or use port-forward:
qovery port-forward --application airbyte-webapp-proxy --port 8080:443
# Then open http://localhost:8080
```

### Cleanup

```bash
terraform destroy
```

### Key Takeaways

This example demonstrates:

1. **Multi-service deployment**: Database + Helm chart + Proxy application
2. **Deployment stages**: Ensuring proper deployment order (DB → App → Proxy)
3. **Dynamic configuration**: Using Qovery's database connection details in Helm values
4. **External Helm charts**: Integrating third-party Helm repositories
5. **Security**: Optional basic authentication for web access
6. **Health checks**: Proper liveness and readiness probes
7. **Resource management**: Setting appropriate CPU/memory limits

## Advanced Patterns

### Using Terraform Modules

Organize your Terraform code with reusable modules:

```
terraform-qovery/
├── main.tf
├── variables.tf
├── outputs.tf
└── modules/
    ├── environment/
    │   ├── main.tf
    │   ├── variables.tf
    │   └── outputs.tf
    ├── application/
    │   ├── main.tf
    │   ├── variables.tf
    │   └── outputs.tf
    └── database/
        ├── main.tf
        ├── variables.tf
        └── outputs.tf
```

**Example module usage**:

```hcl
# modules/application/main.tf
variable "environment_id" {}
variable "name" {}
variable "git_url" {}
variable "git_branch" { default = "main" }
variable "cpu" { default = 500 }
variable "memory" { default = 512 }

resource "qovery_application" "app" {
  environment_id = var.environment_id
  name           = var.name

  git_repository = {
    url    = var.git_url
    branch = var.git_branch
  }

  build_mode = "DOCKER"
  cpu        = var.cpu
  memory     = var.memory

  ports = [{
    internal_port       = 8080
    external_port       = 443
    protocol            = "HTTP"
    publicly_accessible = true
  }]

  auto_deploy = var.git_branch != "main"
}

output "id" {
  value = qovery_application.app.id
}

output "external_host" {
  value = qovery_application.app.external_host
}
```

**Using the module**:

```hcl
# main.tf
module "api" {
  source = "./modules/application"

  environment_id = qovery_environment.prod.id
  name           = "api"
  git_url        = "https://github.com/my-org/api"
  git_branch     = "main"
  cpu            = 1000
  memory         = 1024
}

module "frontend" {
  source = "./modules/application"

  environment_id = qovery_environment.prod.id
  name           = "frontend"
  git_url        = "https://github.com/my-org/frontend"
  git_branch     = "main"
  cpu            = 500
  memory         = 512
}
```

### Workspaces for Multi-Environment

Use Terraform workspaces to manage multiple environments:

```bash
# Create workspaces
terraform workspace new dev
terraform workspace new staging
terraform workspace new production

# Switch workspaces
terraform workspace select dev
terraform apply

terraform workspace select production
terraform apply
```

**Configure based on workspace**:

```hcl
locals {
  environment = terraform.workspace

  config = {
    dev = {
      mode   = "DEVELOPMENT"
      cpu    = 250
      memory = 256
    }
    staging = {
      mode   = "STAGING"
      cpu    = 500
      memory = 512
    }
    production = {
      mode   = "PRODUCTION"
      cpu    = 1000
      memory = 1024
    }
  }
}

resource "qovery_environment" "env" {
  project_id = var.project_id
  cluster_id = var.cluster_id
  name       = local.environment
  mode       = local.config[local.environment].mode
}

resource "qovery_application" "app" {
  environment_id = qovery_environment.env.id
  name           = "my-app"

  cpu    = local.config[local.environment].cpu
  memory = local.config[local.environment].memory

  # ... rest of configuration
}
```

## Useful Resources

<CardGroup cols={2}>
  <Card title="Airbyte Example Repo" icon="github" href="https://github.com/evoxmusic/qovery-airbyte">
    Complete Airbyte deployment example
  </Card>

  <Card title="Provider Documentation" icon="book" href="https://registry.terraform.io/providers/Qovery/qovery/latest/docs">
    Complete reference documentation
  </Card>

  <Card title="Getting Started" icon="rocket" href="/terraform/overview">
    Back to Terraform Provider overview
  </Card>

  <Card title="More Examples" icon="code" href="https://github.com/Qovery/terraform-examples">
    Additional examples on GitHub
  </Card>
</CardGroup>
