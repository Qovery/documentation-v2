---
title: "Bring Your Own AKS Cluster (BYOK)"
description: "Connect your existing Azure AKS cluster to Qovery"
---

## Overview

Bring Your Own Kubernetes (BYOK) allows you to connect your existing AKS cluster to Qovery. You maintain full control over your cluster while Qovery manages application deployments.

## Prerequisites

<Check>Existing AKS cluster (Kubernetes 1.24+)</Check>
<Check>kubectl access with cluster-admin permissions</Check>
<Check>Azure service principal or managed identity for Qovery</Check>
<Check>Azure Disk CSI driver installed</Check>
<Check>Load Balancer or Application Gateway configured</Check>

## Setup

<Steps>
  <Step title="Get Qovery Agent Manifests">
    In Qovery Console:
    1. Settings → Clusters → Add Cluster
    2. Select "Bring Your Own Kubernetes"
    3. Choose "Azure AKS"
    4. Download Helm values or kubectl manifests
  </Step>

  <Step title="Install Qovery Agent">
    Using Helm (recommended):
    ```bash
    helm repo add qovery https://helm.qovery.com
    helm repo update

    helm install qovery-agent qovery/qovery-agent \
      --namespace qovery \
      --create-namespace \
      --values qovery-values.yaml
    ```

    Or using kubectl:
    ```bash
    kubectl apply -f qovery-agent.yaml
    ```
  </Step>

  <Step title="Verify Connection">
    Check agent status:
    ```bash
    kubectl get pods -n qovery
    # qovery-agent-* should be Running
    ```

    In Qovery Console, cluster should show as "Connected"
  </Step>

  <Step title="Deploy Applications">
    Start deploying applications to your BYOK cluster
  </Step>
</Steps>

## What Qovery Installs

**Qovery Agent**:
- Manages application deployments
- Communicates with Qovery Control Plane
- Handles secrets and configuration

**Optional Components** (if not present):
- Nginx Ingress Controller
- Cert-Manager (for SSL certificates)
- External-DNS (for domain management)
- Metrics Server

## Requirements

### Kubernetes Version

- Minimum: 1.24
- Recommended: 1.27+
- Maximum: 1.29

### Required Addons

<Tabs>
  <Tab title="Storage">
    **Azure Disk CSI Driver**:

    AKS clusters have this enabled by default. Verify:
    ```bash
    kubectl get csidriver disk.csi.azure.com
    ```

    **Storage Class**:
    ```yaml
    apiVersion: storage.k8s.io/v1
    kind: StorageClass
    metadata:
      name: managed-premium
      annotations:
        storageclass.kubernetes.io/is-default-class: "true"
    provisioner: disk.csi.azure.com
    parameters:
      storageaccounttype: Premium_LRS
      kind: Managed
    ```
  </Tab>

  <Tab title="Load Balancer">
    **Azure Load Balancer** (default for AKS):

    Automatically configured for Service type LoadBalancer.

    **Application Gateway Ingress Controller** (optional):
    ```bash
    # Enable via AKS addon
    az aks enable-addons \
      -n YOUR_CLUSTER \
      -g YOUR_RESOURCE_GROUP \
      -a ingress-appgw \
      --appgw-name YOUR_APP_GATEWAY
    ```

    **Or Nginx Ingress Controller**:
    ```bash
    helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
    helm install nginx-ingress ingress-nginx/ingress-nginx \
      --set controller.service.type=LoadBalancer \
      --set controller.service.annotations."service\.beta\.kubernetes\.io/azure-load-balancer-health-probe-request-path"=/healthz
    ```
  </Tab>

  <Tab title="Metrics">
    **Metrics Server**:

    Usually pre-installed on AKS. Verify:
    ```bash
    kubectl top nodes
    ```

    If not installed:
    ```bash
    kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
    ```
  </Tab>
</Tabs>

### Azure RBAC Permissions

Qovery needs Azure permissions for:
- Creating/managing Load Balancers and Public IPs
- Managing Azure DNS zones (if using)
- Azure Container Registry access (if using ACR)

Example service principal roles:
- `Network Contributor` (for load balancers)
- `DNS Zone Contributor` (for DNS management)
- `AcrPull` (for ACR access)

```bash
# Create service principal for Qovery
az ad sp create-for-rbac --name qovery-agent --role Contributor \
  --scopes /subscriptions/SUBSCRIPTION_ID/resourceGroups/RESOURCE_GROUP

# Assign specific roles
az role assignment create \
  --assignee APP_ID \
  --role "Network Contributor" \
  --scope /subscriptions/SUBSCRIPTION_ID/resourceGroups/RESOURCE_GROUP

az role assignment create \
  --assignee APP_ID \
  --role "DNS Zone Contributor" \
  --scope /subscriptions/SUBSCRIPTION_ID/resourceGroups/DNS_RESOURCE_GROUP
```

## Cluster Configuration

### Resource Requirements

**Minimum**:
- 2 nodes (Standard_B2s or larger)
- 4 vCPUs total
- 8 GB RAM total

**Recommended**:
- 3+ nodes across availability zones
- Auto-scaling enabled
- Mix of regular and Spot VMs

### Networking

**VNet Requirements**:
- Dedicated subnet for AKS nodes
- Separate subnet for pods (Azure CNI)
- NAT Gateway or Azure Firewall for outbound
- Network Security Groups configured

**Network Plugins**:
- Azure CNI (recommended for production)
- Kubenet (simpler, fewer IP requirements)

### DNS Configuration

**Option 1**: External-DNS (automated)
```bash
helm install external-dns bitnami/external-dns \
  --set provider=azure \
  --set azure.resourceGroup=YOUR_RG \
  --set azure.tenantId=YOUR_TENANT \
  --set azure.subscriptionId=YOUR_SUB \
  --set txtOwnerId=my-cluster
```

**Option 2**: Manual DNS management
- Create Azure DNS records manually for each application
- Point to load balancer public IP

## Best Practices

<CardGroup cols={2}>
  <Card title="Separate Namespaces" icon="folder-tree">
    - Use dedicated namespace for Qovery (`qovery`)
    - Separate namespaces per environment
    - Apply resource quotas
    - Network policies for isolation
  </Card>

  <Card title="Access Control" icon="key">
    - Use Azure AD integration
    - Create managed identity for Qovery
    - Use RBAC for least privilege
    - Rotate service principal credentials regularly
  </Card>

  <Card title="High Availability" icon="shield">
    - Multi-zone node distribution
    - Zone-redundant storage
    - Pod disruption budgets
    - Regular backups to Azure Backup
  </Card>

  <Card title="Monitoring" icon="chart-line">
    - Enable Azure Monitor for containers
    - Set up alerts for Qovery agent
    - Monitor cluster resource usage
    - Integrate with Azure Log Analytics
  </Card>
</CardGroup>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Agent Not Connecting">
    **Solutions**:
    - Verify agent pods are running: `kubectl get pods -n qovery`
    - Check agent logs: `kubectl logs -n qovery -l app=qovery-agent`
    - Ensure outbound internet access (NAT Gateway configured)
    - Verify API token is correct
    - Check Network Security Group rules
  </Accordion>

  <Accordion title="Deployments Failing">
    **Solutions**:
    - Check node capacity and resources
    - Verify storage class exists and works
    - Ensure ingress controller is working
    - Check for network policy blocking traffic
    - Review Azure Monitor logs
  </Accordion>

  <Accordion title="Load Balancers Not Creating">
    **Solutions**:
    - Verify service principal has Network Contributor role
    - Check Network Security Group allows traffic
    - Ensure subnet has available IP addresses
    - Review load balancer health probes
    - Check Azure Activity Log for errors
  </Accordion>
</AccordionGroup>

## Next Steps

<CardGroup cols={2}>
  <Card title="Deploy Application" icon="rocket" href="/deploy-my-app">
    Deploy your first application
  </Card>

  <Card title="Cluster Configuration" icon="sliders" href="/using-qovery/configuration/clusters">
    Configure cluster settings
  </Card>

  <Card title="Qovery-Managed AKS" icon="wand-magic-sparkles" href="/integrations/kubernetes/aks/managed">
    Consider Qovery-managed for easier management
  </Card>

  <Card title="Kubernetes Documentation" icon="book" href="/installation/kubernetes">
    Generic Kubernetes BYOK guide
  </Card>
</CardGroup>
